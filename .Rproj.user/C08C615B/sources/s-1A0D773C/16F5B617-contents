---
title: "Module 4 Lab key"
author: "Tim Essington"
date: "9/6/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Part 1. Dynamic Behavior of Logistic Population Model

#### Q1a.  Values of r and s where model behavior shifts
| r       | Slope   | Behavior                               |
|---------|---------|----------------------------------------|
| r<1     | s>0     | Monotonically approach equilibrium     |
| r=1     | s=0     | Dampened oscillations                  |
| r=2     | s=-1    | Sustained oscillations - 2 point cycle |
| r=2.25  | s=-1.25 | Sustained oscillations - 4 point cycle |
| r=2.55  | s=-1.55 | Sustained oscillations - 8 point cycle |
| r= 2.57 | s=-1.57 | Deterministic chaos                    |


#### Q1b. 
As the slope of the recursive equation decreases from 0.95 to 0, the population trajectory always smoothly approaches equilibrium, but does so more rapidly as the slope becomes closer to 0.  Once the slope drops below 0, the population trajectory increases beyond carrying capacity and then exhibits damped oscillations until equilibrium is achieved (these are hard to see graphically until the slope drops below -0.25).  Biologically, this implies that the population growth rate potential is so large that the population trajectory “overshoots” the equilibrium. When it recovers back to a size below carrying capacity, it ends up at a population size slightly closer to *K* than when the oscillations began.  In this manner, the population will expand and contract, each time moving closer and closer to the carrying capacity. 

As the inherent growth rate increases further, the slope of the recursive equation becomes more sharply downwards facing, leading to sustained oscilliations, or a limit cycle.  Here growth above the carrying capacity leads to decline below the carrying capacity, which then repeats itself forever.  As the dome shape of the logistic function becomes more pronounced by increasing *r*, you can get 4 point cycles, and then 8 point cycles before it quickly becomes chaotic.

In general we think of negative feedbacks as being stabilizing features of systems.  Density dependence is an example of a negative feedback, but in this example, we see that is only partly stabilizing.  Density dependence coupled with high intrinsic productivity cause the model to rapidly reach equilibrium.  However, once the intrinsic growth rate increases, the model became less stable: namely a small perturbation away from equilibrium will cause the population to move away from, rather than back toward the carrying capacity.
	
Moreover, we started this week with a plot of long term population dynamics of two insect species, both of which exhibited enormous variability. Our tendency in interpreting such dynamics is to think that there is some highly variable, external driver on population sizes (extrinsic control).  This week’s model exercise demonstrated that such wildly variable population dynamics can be produced solely by intrinsic processes (e.g., the density-dependent effects on population growth rate), and also gave us some indications of the conditions in which intrinsic processes might be responsible.

## Part 2: Structured Population Models
#### R Code
```{r part_2}

## Define Parameters

F3 <- 10
F4 <- 15
F5 <- 20
S1 <- 0.2
S2 <- 0.3
S3 <- 0.4
S4 <- 0.5

# Initial Conditions
N1.start <- 20
N2.start <- 15
N3.start <- 10
N4.start <- 5
N5.start <- 1

tmax <- 50
years <- 0:tmax


# Setup matrix to hold model output, with each year in row, each age in column

output <- matrix (NA, nrow = length(years), ncol = 5)
colnames(output) <- c("Age 1", "Age 2", "Age 3", "Age 4", "Age 5")

# Input starting values into the first row

output[1,]<- c(N1.start, N2.start, N3.start, N4.start, N5.start)

####################################################################
# A generic loop, Insert new equations on the right hand side for each row
## MODIFY THIS LOOP and code below TO GENERATE POPULATION DYNAMICS.
for (i in 1:tmax){
  output[i+1,1]<- output[i, 3] * F3 + output[i, 4] * F4 + output[i,5] * F5
  output[i+1,2]<- output[i,1] * S1
  output[i+1,3]<- output[i,2] * S2
  output[i+1,4]<- output[i,3] * S3
  output[i+1,5]<- output[i,4] * S4
}

# calculate stable age distribution in year 100
N.stable <- output[tmax,]  / sum(output[tmax,])
print(N.stable)
  
# Calculate population growth rate in year 100
lambda <- sum(output[tmax,]) / sum(output[tmax-1,])
print(lambda)

#### Code the model with matrix algebra
# Create Transition Matrix

A <- matrix(0, nrow = 5, ncol = 5)
A[1,3:5] <- c(F3, F4, F5)
A[2,1] <- S1
A[3,2] <- S2
A[4,3] <- S3
A[5,4] <- S4
print(A)

for (i in 1:tmax){
  output[i+1,] <- A %*% output[i,]
}

# Not necessary, but here is a plot:
library(viridis)
cols <- plasma(n=5)

matplot(years, output,
     type = "l",
     lty = "solid",
     lwd = 2,
     col = cols,
     xlab = "year",
     ylab = "Abundance",
     las = 1)
  
```

## Interpretting Elasticitiites
#### 3b. 
They illustrate how a proportional change in one parameter produces a (proportional) change in the population growth rate.  They are scaled so that they sum to one, so they are often viewed as the proportional contribution of each parameter to the population growth rate. Parameters with a high elasticity means that they have a high influence on the population growth rate.

#### 3c and 3d
1.	S1 and S2
2.	F3, S3
3.	F4
4.	F5 and S4
The survivorship of age 1 and age 2 has the most influence on population growth rate, while Age 5 fecundity and age 4 survivorship have the lowest importance. Because we do not allow animals to live past age 5, parameters that directly affect the number of 5 year olds do little for the population growth rate. Similarly, there aren’t many 5 year olds in the population so their fecundity doesn’t really contribute much to the population.  The elasticity of survivorship for age 2 and age 3 make sense: most of the individuals in this population are in these age classes, and these two stages are immediately prior those that have the highest reproductive value: often parameters that dictate life history stages that have high reproductive value have especially strong effects on the population growth rate. Fecundity levels are not tremendously important because few of the offspring survive to become mature.
Note: the “unimportance” of S4/F5 have nothing to do with being close to the end of the life cycle. There are other species for which later stages are more important – it has to do with the specifics of this model.  Consider a semelparous species for instance - here you expect survivorship to the age of maturity and fecundity of this age to be especially important.
