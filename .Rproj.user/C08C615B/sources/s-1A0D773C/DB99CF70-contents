---
title: "Module 2 Homework Key"
author: "Tim Essington"
date: "9/6/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Ricker Model Analysis
#### 1a

| $\alpha_l$ | Slope   | Behavior                               |
|----------|---------|----------------------------------------|
| $\alpha_l$ <1     | s>0     | Monotonically approach equilibrium     |
| $\alpha_l$ =1      | s=0     | Dampened oscillations                  |
| $\alpha_l$ =2      | s=-1    | Sustained oscillations - 2 point cycle |
| $\alpha_l$ =2.52   | s=-1.52 | Sustained oscillations - 4 point cycle |
| $\alpha_l$ =2.66   | s=-1.66 | Sustained oscillations - 8 point cycle |
| $\alpha_l$ = 2.7  | s=-1.7 | Deterministic chaos                    |

#### 1b
The Ricker model is quite similar to the logistic model.  In fact, the cut off values for dampenedd oscillations, and from dampened oscillations to 2 point limit cycles are identical when we look at either the log- maximum growth rate, or more importantly the slope of the recursive equation at equilibrium (*s*<0, *s*<-1).  

The models begin to diverge for more negative values of *s*.  In the logistic model, small changes in *s* caused fairly radical changes in the population dynamics, such that the model went from 2 point limit cycles to chaos very quickly.  In comparison, the Ricker model can be pushed to much steeper slopes at equilibrium while still maintaining limit cycles.

#### 1c
The differences above are a consequence of the concave shape of the logistic function, compared to the convex shape of the Ricker function.  The latter offers a bit of stability, especially when *s* is a very small number, by reducing the extent of swings above and below the carrying capacity.  Some may notice that the Ricker model will never produce a negative population size but the logistic curve will.  

#### 1d
Generally, we can infer that the points raised in lab based on the logistic model seem to be a general phenomena â€“ very strong density dependence in population growth rate, coupled with a high intrinsic growth rate, can produce unstable dynamics characterized by dampened oscillations, limit cycles and chaos. Thus, negative feedbacks can cause the system to be highly variable rather than dampening the effect of extrinsic drivers.


## Part 2: Stage structured model of Dungeness Crab

```{r crab}
P.egg <- 0.75
G.egg<- 0.25
P.larvae <- 0.14
G.larvae <- 0.00032
P.juvenile <- 0.82
G.juvenile<- 0.00154
P.adult <- 0.975
F.adult <- 9000

# Create a blank A matrix full of zeros
A <- matrix (0, nrow = 4, ncol = 4)
rownames(A) <- colnames(A) <- c("Egg", "Larvae", "Juvenile", "Adult")

A[1,] <- c(P.egg, 0, 0, F.adult)
A[2,] <- c(G.egg, P.larvae, 0, 0)
A[3,] <- c(0, G.larvae, P.juvenile, 0)
A[4,] <- c(0, 0, G.juvenile, P.adult)

print(A)

# Calculate dominant eigenvalue
eigs <- eigen(A)
lambda <- max(Re(eigs$values))
print(lambda)
# This is in monthly time steps, to get annual population growth rate, must multiply by itself 12 times or:
print(lambda ^ 12)

```

## Part 3: Simulating the dynamics
```{r crabs2}
P.egg <- 0.75
G.egg<- 0.25
P.larvae <- 0.14
G.larvae <- 0.00032
P.juvenile <- 0.82
G.juvenile<- 0.00154
P.adult <- 0.975
F.adult <- 9000

# Create a blank A matrix full of zeros
A <- matrix (0, nrow = 4, ncol = 4)
rownames(A) <- colnames(A) <- c("Egg", "Larvae", "Juvenile", "Adult")

A[1,] <- c(P.egg, 0, 0, F.adult)
A[2,] <- c(G.egg, P.larvae, 0, 0)
A[3,] <- c(0, G.larvae, P.juvenile, 0)
A[4,] <- c(0, 0, G.juvenile, P.adult)

tmax = 50*12 # converting years to months. I want 50 years.
years = 0:tmax
nstart <- c(1000, 5, 2.5, 1) # these are arbitrary

output <- matrix(NA, nrow = length(years), ncol = 4)
output[1,] <- nstart

for (i in 1:tmax){
  output[i+1,] <- A %*% output[i,]
}

library(viridis)
cols <- plasma(n=5)

matplot(years, output,
     type = "l",
     lty = "solid",
     lwd = 2,
     col = cols,
     xlab = "month",
     ylab = "Abundance",
     las = 1)
# get lambda from simulation
lambda <- sum(output[tmax,]) / sum(output[tmax-1,])
print(lambda)


```
